import{getAudioContext as e}from"./AudioEngine.js";export class Track{constructor(e,t,i){this.id=e,this.buffer=t,this.name=i,this.isPlaying=!1,this.trimStart=0,this.trimEnd=1,this.localRate=1,this.currentEffect="bypass",this.effectParams={x:.5,y:.5},this.sourceNode=null,this.gainNode=null,this.fxInput=null,this.fxOutput=null,this.filterNode=null,this.highpassNode=null,this.bandpassNode=null,this.autoFilterNode=null,this.autoFilterLfo=null,this.autoFilterLfoGain=null,this.phaserFilters=[],this.phaserLfo=null,this.phaserLfoGain=null,this.phaserMix=null,this.flangerDelay=null,this.flangerFeedback=null,this.flangerMix=null,this.flangerLfo=null,this.flangerLfoGain=null,this.chorusDelayL=null,this.chorusDelayR=null,this.chorusMix=null,this.chorusLfoL=null,this.chorusLfoR=null,this.chorusLfoGainL=null,this.chorusLfoGainR=null,this.tremoloGain=null,this.tremoloLfo=null,this.tremoloLfoGain=null,this.vibratoDelay=null,this.vibratoMix=null,this.vibratoLfo=null,this.vibratoLfoGain=null,this.delayNode=null,this.delayFeedback=null,this.delayMix=null,this.echoDelay=null,this.echoFeedback=null,this.echoLowpass=null,this.echoMix=null,this.pingpongSplit=null,this.pingpongMerge=null,this.pingpongDelayL=null,this.pingpongDelayR=null,this.pingpongFeedback=null,this.pingpongMix=null,this.reverbNode=null,this.reverbMix=null,this.reverbSeconds=2,this.reverbDecay=2,this.distNode=null,this.distTone=null,this.overdriveNode=null,this.overdriveTone=null,this.saturationNode=null,this.saturationTone=null,this.bitcrusherNode=null,this.compressorNode=null,this.limiterNode=null,this.widenerSplit=null,this.widenerDelay=null,this.widenerMerge=null,this.widenerDryGain=null,this.widenerWetGain=null,this.pannerNode=null,this.pannerGain=null,this.pitchNode=null,this.pitchDryGain=null,this.pitchWetGain=null,this.harmonizerNode=null,this.harmonizerDryGain=null,this.harmonizerWetGain=null,this.granularNode=null,this.granularDryGain=null,this.granularWetGain=null,this.initAudioGraph()}initAudioGraph(t=null){const i=t||e();this.gainNode=i.createGain(),t||this.gainNode.connect(i.destination),this.fxInput=i.createGain(),this.fxOutput=i.createGain(),this.fxOutput.connect(this.gainNode),this.filterNode=i.createBiquadFilter(),this.filterNode.type="lowpass",this.filterNode.frequency.value=2e4,this.highpassNode=i.createBiquadFilter(),this.highpassNode.type="highpass",this.highpassNode.frequency.value=20,this.bandpassNode=i.createBiquadFilter(),this.bandpassNode.type="bandpass",this.bandpassNode.frequency.value=800,this.autoFilterNode=i.createBiquadFilter(),this.autoFilterNode.type="lowpass",this.autoFilterNode.frequency.value=600,this.autoFilterLfo=i.createOscillator(),this.autoFilterLfo.type="sine",this.autoFilterLfoGain=i.createGain(),this.autoFilterLfo.connect(this.autoFilterLfoGain),this.autoFilterLfoGain.connect(this.autoFilterNode.frequency),this.autoFilterLfo.start(),this.phaserFilters=Array.from({length:4},()=>{const e=i.createBiquadFilter();return e.type="allpass",e.frequency.value=800,e}),this.phaserLfo=i.createOscillator(),this.phaserLfo.type="sine",this.phaserLfoGain=i.createGain(),this.phaserLfo.connect(this.phaserLfoGain),this.phaserFilters.forEach(e=>this.phaserLfoGain.connect(e.frequency)),this.phaserLfo.start(),this.phaserMix=i.createGain(),this.flangerDelay=i.createDelay(.05),this.flangerFeedback=i.createGain(),this.flangerMix=i.createGain(),this.flangerLfo=i.createOscillator(),this.flangerLfo.type="sine",this.flangerLfoGain=i.createGain(),this.flangerLfo.connect(this.flangerLfoGain),this.flangerLfoGain.connect(this.flangerDelay.delayTime),this.flangerLfo.start(),this.chorusDelayL=i.createDelay(.05),this.chorusDelayR=i.createDelay(.05),this.chorusMix=i.createGain(),this.chorusLfoL=i.createOscillator(),this.chorusLfoR=i.createOscillator(),this.chorusLfoGainL=i.createGain(),this.chorusLfoGainR=i.createGain(),this.chorusLfoL.connect(this.chorusLfoGainL),this.chorusLfoGainL.connect(this.chorusDelayL.delayTime),this.chorusLfoR.connect(this.chorusLfoGainR),this.chorusLfoGainR.connect(this.chorusDelayR.delayTime),this.chorusLfoL.start(),this.chorusLfoR.start(),this.tremoloGain=i.createGain(),this.tremoloLfo=i.createOscillator(),this.tremoloLfo.type="sine",this.tremoloLfoGain=i.createGain(),this.tremoloLfo.connect(this.tremoloLfoGain),this.tremoloLfoGain.connect(this.tremoloGain.gain),this.tremoloLfo.start(),this.vibratoDelay=i.createDelay(.05),this.vibratoMix=i.createGain(),this.vibratoLfo=i.createOscillator(),this.vibratoLfo.type="sine",this.vibratoLfoGain=i.createGain(),this.vibratoLfo.connect(this.vibratoLfoGain),this.vibratoLfoGain.connect(this.vibratoDelay.delayTime),this.vibratoLfo.start(),this.delayNode=i.createDelay(2.5),this.delayFeedback=i.createGain(),this.delayMix=i.createGain(),this.echoDelay=i.createDelay(1.2),this.echoFeedback=i.createGain(),this.echoLowpass=i.createBiquadFilter(),this.echoLowpass.type="lowpass",this.echoLowpass.frequency.value=3e3,this.echoMix=i.createGain(),this.pingpongSplit=i.createChannelSplitter(2),this.pingpongMerge=i.createChannelMerger(2),this.pingpongDelayL=i.createDelay(2),this.pingpongDelayR=i.createDelay(2),this.pingpongFeedback=i.createGain(),this.pingpongMix=i.createGain(),this.reverbNode=i.createConvolver(),this.reverbMix=i.createGain(),this.reverbNode.buffer=this.createImpulseResponse(i,this.reverbSeconds,this.reverbDecay),this.distNode=i.createWaveShaper(),this.distNode.curve=this.makeDistortionCurve(0),this.distNode.oversample="4x",this.distTone=i.createBiquadFilter(),this.distTone.type="lowpass",this.distTone.frequency.value=16e3,this.overdriveNode=i.createWaveShaper(),this.overdriveNode.curve=this.makeOverdriveCurve(.2),this.overdriveNode.oversample="4x",this.overdriveTone=i.createBiquadFilter(),this.overdriveTone.type="lowpass",this.overdriveTone.frequency.value=14e3,this.saturationNode=i.createWaveShaper(),this.saturationNode.curve=this.makeSaturationCurve(.2),this.saturationNode.oversample="4x",this.saturationTone=i.createBiquadFilter(),this.saturationTone.type="lowpass",this.saturationTone.frequency.value=15e3,this.bitcrusherNode=this.createBitcrusher(i),this.compressorNode=i.createDynamicsCompressor(),this.limiterNode=i.createDynamicsCompressor(),this.widenerSplit=i.createChannelSplitter(2),this.widenerDelay=i.createDelay(.03),this.widenerMerge=i.createChannelMerger(2),this.widenerDryGain=i.createGain(),this.widenerWetGain=i.createGain(),this.pannerNode=i.createStereoPanner(),this.pannerGain=i.createGain(),this.pitchNode=this.createPitchShifter(i),this.pitchDryGain=i.createGain(),this.pitchWetGain=i.createGain(),this.harmonizerNode=this.createPitchShifter(i),this.harmonizerDryGain=i.createGain(),this.harmonizerWetGain=i.createGain(),this.granularNode=this.createGranularProcessor(i),this.granularDryGain=i.createGain(),this.granularWetGain=i.createGain(),this.refreshEffectRouting()}makeDistortionCurve(e){const t="number"==typeof e?e:50,i=44100,s=new Float32Array(i),n=Math.PI/180;for(let e=0;e<i;++e){const a=2*e/i-1;s[e]=(3+t)*a*20*n/(Math.PI+t*Math.abs(a))}return s}makeOverdriveCurve(e){const t=Math.max(.1,30*e),i=44100,s=new Float32Array(i);for(let e=0;e<i;++e){const n=2*e/i-1;s[e]=(1+t)*n/(1+t*Math.abs(n))}return s}makeSaturationCurve(e){const t=1+8*e,i=44100,s=new Float32Array(i);for(let e=0;e<i;++e){const n=2*e/i-1;s[e]=Math.tanh(t*n)}return s}createImpulseResponse(e,t,i){const s=e.sampleRate,n=Math.max(1,Math.floor(s*t)),a=e.createBuffer(2,n,s);for(let e=0;e<2;e++){const t=a.getChannelData(e);for(let e=0;e<n;e++){const s=e/n;t[e]=(2*Math.random()-1)*Math.pow(1-s,i)}}return a}createBitcrusher(e){const t=e.createScriptProcessor(2048,2,2);t.bits=8,t.normFreq=.5;let i=0,s=0,n=0;return t.onaudioprocess=e=>{const a=e.inputBuffer.getChannelData(0),r=e.inputBuffer.numberOfChannels>1?e.inputBuffer.getChannelData(1):a,h=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1),c=Math.pow(.5,t.bits);for(let e=0;e<a.length;e++)i+=t.normFreq,i>=1&&(i-=1,s=c*Math.floor(a[e]/c+.5),n=c*Math.floor(r[e]/c+.5)),h[e]=s,o[e]=n},t}createPitchShifter(e){const t=e.createScriptProcessor(1024,2,2),i=4096,s=new Float32Array(i),n=new Float32Array(i);let a=0,r=0;t.pitchRatio=1;const h=(e,t)=>{const s=Math.floor(t),n=(s+1)%i,a=t-s;return e[s]+(e[n]-e[s])*a};return t.onaudioprocess=e=>{const o=e.inputBuffer.getChannelData(0),c=e.inputBuffer.numberOfChannels>1?e.inputBuffer.getChannelData(1):o,l=e.outputBuffer.getChannelData(0),u=e.outputBuffer.getChannelData(1),p=Math.max(.5,Math.min(t.pitchRatio,2));for(let e=0;e<o.length;e++){s[a]=o[e],n[a]=c[e],a=(a+1)%i,r=(r+p)%i;const t=(r+2048)%i;let f=r/i*2;f>1&&(f=2-f);const d=h(s,r)*f+h(s,t)*(1-f),g=h(n,r)*f+h(n,t)*(1-f);l[e]=d,u[e]=g}},t}createGranularProcessor(e){const t=e.createScriptProcessor(1024,2,2),i=8192,s=new Float32Array(i),n=new Float32Array(i);let a=0,r=0,h=0;return t.grainSize=2048,t.spray=.3,t.onaudioprocess=e=>{const o=e.inputBuffer.getChannelData(0),c=e.inputBuffer.numberOfChannels>1?e.inputBuffer.getChannelData(1):o,l=e.outputBuffer.getChannelData(0),u=e.outputBuffer.getChannelData(1);for(let e=0;e<o.length;e++){if(s[a]=o[e],n[a]=c[e],a=(a+1)%i,0===h){const e=Math.floor(t.spray*i*.5),s=Math.floor(Math.random()*Math.max(1,e));r=(a-s+i)%i}l[e]=s[r],u[e]=n[r],r=(r+1)%i,h=(h+1)%t.grainSize}},t}refreshEffectRouting(){if(!this.fxInput)return;const e=e=>{if(e)try{e.disconnect()}catch(e){}};switch(e(this.fxInput),e(this.filterNode),e(this.highpassNode),e(this.bandpassNode),e(this.autoFilterNode),this.phaserFilters.forEach(e),e(this.phaserMix),e(this.flangerDelay),e(this.flangerFeedback),e(this.flangerMix),e(this.chorusDelayL),e(this.chorusDelayR),e(this.chorusMix),e(this.tremoloGain),e(this.vibratoDelay),e(this.vibratoMix),e(this.delayNode),e(this.delayFeedback),e(this.delayMix),e(this.echoDelay),e(this.echoFeedback),e(this.echoLowpass),e(this.echoMix),e(this.pingpongSplit),e(this.pingpongDelayL),e(this.pingpongDelayR),e(this.pingpongFeedback),e(this.pingpongMerge),e(this.pingpongMix),e(this.reverbNode),e(this.reverbMix),e(this.distNode),e(this.distTone),e(this.overdriveNode),e(this.overdriveTone),e(this.saturationNode),e(this.saturationTone),e(this.bitcrusherNode),e(this.compressorNode),e(this.limiterNode),e(this.widenerSplit),e(this.widenerDelay),e(this.widenerMerge),e(this.widenerDryGain),e(this.widenerWetGain),e(this.pannerNode),e(this.pannerGain),e(this.pitchNode),e(this.pitchDryGain),e(this.pitchWetGain),e(this.harmonizerNode),e(this.harmonizerDryGain),e(this.harmonizerWetGain),e(this.granularNode),e(this.granularDryGain),e(this.granularWetGain),this.currentEffect){case"filter":this.fxInput.connect(this.filterNode),this.filterNode.connect(this.fxOutput);break;case"highpass":this.fxInput.connect(this.highpassNode),this.highpassNode.connect(this.fxOutput);break;case"bandpass":this.fxInput.connect(this.bandpassNode),this.bandpassNode.connect(this.fxOutput);break;case"autofilter":this.fxInput.connect(this.autoFilterNode),this.autoFilterNode.connect(this.fxOutput);break;case"phaser":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.phaserFilters[0]),this.phaserFilters.reduce((e,t)=>(e.connect(t),t)),this.phaserFilters[this.phaserFilters.length-1].connect(this.phaserMix),this.phaserMix.connect(this.fxOutput);break;case"flanger":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.flangerDelay),this.flangerDelay.connect(this.flangerMix),this.flangerMix.connect(this.fxOutput),this.flangerDelay.connect(this.flangerFeedback),this.flangerFeedback.connect(this.flangerDelay);break;case"chorus":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.chorusDelayL),this.fxInput.connect(this.chorusDelayR),this.chorusDelayL.connect(this.chorusMix),this.chorusDelayR.connect(this.chorusMix),this.chorusMix.connect(this.fxOutput);break;case"tremolo":this.fxInput.connect(this.tremoloGain),this.tremoloGain.connect(this.fxOutput);break;case"vibrato":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.vibratoDelay),this.vibratoDelay.connect(this.vibratoMix),this.vibratoMix.connect(this.fxOutput);break;case"delay":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.delayNode),this.delayNode.connect(this.delayMix),this.delayMix.connect(this.fxOutput),this.delayNode.connect(this.delayFeedback),this.delayFeedback.connect(this.delayNode);break;case"echo":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.echoDelay),this.echoDelay.connect(this.echoLowpass),this.echoLowpass.connect(this.echoMix),this.echoMix.connect(this.fxOutput),this.echoLowpass.connect(this.echoFeedback),this.echoFeedback.connect(this.echoDelay);break;case"pingpong":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.pingpongSplit),this.pingpongSplit.connect(this.pingpongDelayL,0),this.pingpongSplit.connect(this.pingpongDelayR,1),this.pingpongDelayL.connect(this.pingpongMerge,0,0),this.pingpongDelayR.connect(this.pingpongMerge,0,1),this.pingpongMerge.connect(this.pingpongMix),this.pingpongMix.connect(this.fxOutput),this.pingpongDelayL.connect(this.pingpongFeedback),this.pingpongDelayR.connect(this.pingpongFeedback),this.pingpongFeedback.connect(this.pingpongDelayL),this.pingpongFeedback.connect(this.pingpongDelayR);break;case"reverb":this.fxInput.connect(this.fxOutput),this.fxInput.connect(this.reverbNode),this.reverbNode.connect(this.reverbMix),this.reverbMix.connect(this.fxOutput);break;case"distortion":this.fxInput.connect(this.distNode),this.distNode.connect(this.distTone),this.distTone.connect(this.fxOutput);break;case"overdrive":this.fxInput.connect(this.overdriveNode),this.overdriveNode.connect(this.overdriveTone),this.overdriveTone.connect(this.fxOutput);break;case"saturation":this.fxInput.connect(this.saturationNode),this.saturationNode.connect(this.saturationTone),this.saturationTone.connect(this.fxOutput);break;case"bitcrusher":this.fxInput.connect(this.bitcrusherNode),this.bitcrusherNode.connect(this.fxOutput);break;case"compressor":this.fxInput.connect(this.compressorNode),this.compressorNode.connect(this.fxOutput);break;case"limiter":this.fxInput.connect(this.limiterNode),this.limiterNode.connect(this.fxOutput);break;case"widener":this.fxInput.connect(this.widenerDryGain),this.widenerDryGain.connect(this.fxOutput),this.fxInput.connect(this.widenerSplit),this.widenerSplit.connect(this.widenerMerge,0,0),this.widenerSplit.connect(this.widenerDelay,1),this.widenerDelay.connect(this.widenerMerge,0,1),this.widenerMerge.connect(this.widenerWetGain),this.widenerWetGain.connect(this.fxOutput);break;case"panner":this.fxInput.connect(this.pannerNode),this.pannerNode.connect(this.pannerGain),this.pannerGain.connect(this.fxOutput);break;case"pitch":this.fxInput.connect(this.pitchDryGain),this.pitchDryGain.connect(this.fxOutput),this.fxInput.connect(this.pitchNode),this.pitchNode.connect(this.pitchWetGain),this.pitchWetGain.connect(this.fxOutput);break;case"harmonizer":this.fxInput.connect(this.harmonizerDryGain),this.harmonizerDryGain.connect(this.fxOutput),this.fxInput.connect(this.harmonizerNode),this.harmonizerNode.connect(this.harmonizerWetGain),this.harmonizerWetGain.connect(this.fxOutput);break;case"granular":this.fxInput.connect(this.granularDryGain),this.granularDryGain.connect(this.fxOutput),this.fxInput.connect(this.granularNode),this.granularNode.connect(this.granularWetGain),this.granularWetGain.connect(this.fxOutput);break;default:this.fxInput.connect(this.fxOutput)}}setEffect(e){this.currentEffect=e,this.refreshEffectRouting(),this.updateEffectParams(this.effectParams.x,this.effectParams.y)}updateEffectParams(e,t){this.effectParams={x:e,y:t};const i=this.fxInput.context,s=i.currentTime,n=(e,t)=>{0===s?e.setValueAtTime(t,0):e.setTargetAtTime(t,s,.02)},a=(e,t,i)=>{const s=Math.log(t),n=Math.log(i);return Math.exp(s+e*(n-s))};switch(this.currentEffect){case"filter":{const i=a(e,80,2e4);n(this.filterNode.frequency,i),n(this.filterNode.Q,.1+20*t);break}case"highpass":{const i=a(e,20,8e3);n(this.highpassNode.frequency,i),n(this.highpassNode.Q,.1+20*t);break}case"bandpass":{const i=a(e,120,12e3);n(this.bandpassNode.frequency,i),n(this.bandpassNode.Q,.1+20*t);break}case"autofilter":{const i=.05+6*e,s=300+6e3*t;n(this.autoFilterNode.frequency,500),n(this.autoFilterLfoGain.gain,s),n(this.autoFilterLfo.frequency,i);break}case"phaser":{const i=.05+3*e,s=200+1200*t;this.phaserFilters.forEach(e=>n(e.frequency,600+400*t)),n(this.phaserLfoGain.gain,s),n(this.phaserLfo.frequency,i),n(this.phaserMix.gain,.7);break}case"flanger":{const i=.05+2*e,s=.75*t;n(this.flangerLfoGain.gain,5e-4+.003*t),n(this.flangerDelay.delayTime,.002),n(this.flangerFeedback.gain,s),n(this.flangerLfo.frequency,i),n(this.flangerMix.gain,.6);break}case"chorus":{const i=.1+1.4*e,s=.002+.015*t;n(this.chorusDelayL.delayTime,.008),n(this.chorusDelayR.delayTime,.012),n(this.chorusLfoGainL.gain,s),n(this.chorusLfoGainR.gain,1.1*s),n(this.chorusLfoL.frequency,i),n(this.chorusLfoR.frequency,1.1*i),n(this.chorusMix.gain,.7);break}case"tremolo":{const i=.5+10*e,s=t;n(this.tremoloGain.gain,1-.5*s),n(this.tremoloLfoGain.gain,.5*s),n(this.tremoloLfo.frequency,i);break}case"vibrato":{const i=2+10*e,s=5e-4+.005*t;n(this.vibratoDelay.delayTime,.004),n(this.vibratoLfoGain.gain,s),n(this.vibratoLfo.frequency,i),n(this.vibratoMix.gain,.7);break}case"delay":n(this.delayNode.delayTime,1.5*e),n(this.delayFeedback.gain,.85*t),n(this.delayMix.gain,.7);break;case"echo":n(this.echoDelay.delayTime,.8*e),n(this.echoFeedback.gain,.6*t),n(this.echoLowpass.frequency,a(1-t,800,5e3)),n(this.echoMix.gain,.6);break;case"pingpong":n(this.pingpongDelayL.delayTime,1.2*e),n(this.pingpongDelayR.delayTime,1.2*e),n(this.pingpongFeedback.gain,.75*t),n(this.pingpongMix.gain,.7);break;case"reverb":{const s=.6+4*e,a=1+4*e;(Math.abs(this.reverbSeconds-s)>.05||Math.abs(this.reverbDecay-a)>.1)&&(this.reverbSeconds=s,this.reverbDecay=a,this.reverbNode.buffer=this.createImpulseResponse(i,s,a)),n(this.reverbMix.gain,t);break}case"distortion":this.distNode.curve=this.makeDistortionCurve(600*e),n(this.distTone.frequency,a(1-t,800,16e3));break;case"overdrive":this.overdriveNode.curve=this.makeOverdriveCurve(.1+e),n(this.overdriveTone.frequency,a(1-t,900,14e3));break;case"saturation":this.saturationNode.curve=this.makeSaturationCurve(.1+.8*e),n(this.saturationTone.frequency,a(1-t,1e3,15e3));break;case"bitcrusher":this.bitcrusherNode.bits=2+Math.floor(14*e),this.bitcrusherNode.normFreq=.05+.95*t;break;case"compressor":n(this.compressorNode.threshold,50*e-60),n(this.compressorNode.ratio,1+19*t),n(this.compressorNode.attack,.005),n(this.compressorNode.release,.12);break;case"limiter":n(this.limiterNode.threshold,20*e-20),n(this.limiterNode.ratio,16),n(this.limiterNode.attack,.003),n(this.limiterNode.release,.02+.18*t);break;case"widener":n(this.widenerDelay.delayTime,.02*e),n(this.widenerWetGain.gain,t),n(this.widenerDryGain.gain,1-.7*t);break;case"panner":n(this.pannerNode.pan,2*e-1),n(this.pannerGain.gain,.5+.5*t);break;case"pitch":{const i=24*e-12,s=Math.pow(2,i/12);this.pitchNode.pitchRatio=s,n(this.pitchWetGain.gain,t),n(this.pitchDryGain.gain,1-.7*t);break}case"harmonizer":{const i=3+9*e,s=Math.pow(2,i/12);this.harmonizerNode.pitchRatio=s,n(this.harmonizerWetGain.gain,t),n(this.harmonizerDryGain.gain,1-.6*t);break}case"granular":{const s=.02+.18*e;this.granularNode.grainSize=Math.floor(i.sampleRate*s),this.granularNode.spray=t,n(this.granularWetGain.gain,.8),n(this.granularDryGain.gain,1-.6*t);break}}}setLocalRate(e){this.localRate=e}updateLivePlaybackRate(e){if(this.sourceNode&&this.isPlaying){const t=this.localRate*e;this.sourceNode.playbackRate.setValueAtTime(Math.max(.1,Math.min(t,4)),this.sourceNode.context.currentTime)}}play(t=1){if(!this.fxInput)return;this.stop();const i=e();this.sourceNode=i.createBufferSource(),this.sourceNode.buffer=this.buffer,this.sourceNode.loop=!0;const s=this.localRate*t;this.sourceNode.playbackRate.value=Math.max(.1,Math.min(s,4));const n=this.buffer.duration;this.sourceNode.loopStart=n*this.trimStart,this.sourceNode.loopEnd=n*this.trimEnd,this.sourceNode.connect(this.fxInput),this.sourceNode.start(0,this.sourceNode.loopStart),this.isPlaying=!0}stop(){if(this.sourceNode){try{this.sourceNode.stop()}catch(e){}this.sourceNode=null}this.isPlaying=!1}destroy(){this.stop(),this.gainNode&&this.gainNode.disconnect()}}
//# sourceMappingURL=Track.js.map